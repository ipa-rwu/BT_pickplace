<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <Fallback name="Job">
            <Sequence name="Task4">
                <Action ID="ACheckConditionFlag" param="{param}" task="3"/>
                <Sequence name="T4finish">
                    <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="1" value="false"/>
                    <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="2" value="false"/>
                    <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="3" value="false"/>
                </Sequence>
            </Sequence>
            <Sequence name="Task3">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Action ID="ACheckConditionFlag" param="{param}" task="2"/>
                <Sequence name="T3Place">
                    <SubTree ContainerPose="containerpose" GripperOut="gripperout" ID="T3PlaceSteps" TagIsObjCon="tagisobjcon" Target="target"/>
                    <SubTree ID="Execution" armcomm="ArmComm" fhelp="FHelp" grippercomm="GripperComm"/>
                </Sequence>
            </Sequence>
            <Sequence name="Task2">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Action ID="ACheckConditionFlag" param="{param}" task="1"/>
                <Sequence name="T2Pick">
                    <SubTree GripperOut="gripperout" ID="T2PickSteps" ObsObjPose="BlockPose" TagIsHold="tagishold" Target="target"/>
                    <SubTree ID="Execution" armcomm="ArmComm" fhelp="FHelp" grippercomm="GripperComm"/>
                </Sequence>
            </Sequence>
            <Sequence name="Task1">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Sequence name="T1FindObj">
                    <SubTree ID="T1FindObjs" blockmarker="1" blockpose="BlockPose" containermarkerA="2" containermarkerB="3" containerpose="ContainerPose"/>
                </Sequence>
            </Sequence>
            <Sequence name="Help">
                <Action ID="AReloadParamArm" initial="" param="{param}"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="Execution">
        <SequenceStar>
            <Fallback name="RobotExec">
                <Sequence name="MoveRobot">
                    <Action ID="BTWaitForTarget" targetin="{armcom}" targetout="{_target}"/>
                    <Action ID="APathPlanning" goal="{_target}" plan="{plan}"/>
                    <Action ID="AFollowPath" plan="{plan}"/>
                </Sequence>
                <Sequence name="NeedHelp">
                    <SetBlackboard name="ASetFlagHelp" output_key="fhelp" value="1"/>
                </Sequence>
            </Fallback>
            <Fallback name="GripperExec">
                <Sequence name="MoveGripper">
                    <Action ID="AGripperMove" command="{grippercom}"/>
                </Sequence>
                <Sequence name="NeedHelp">
                    <SetBlackboard name="ASetFlagHelp" output_key="fhelp" value="1"/>
                </Sequence>
            </Fallback>
        </SequenceStar>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="SubCheckPreCondition">
        <Sequence name="SeqCheckPreCond">
            <Action ID="ACheckConditionArm" goal="{goal}" param="{param}" step="{step}"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="SubGenerateCommand">
        <Sequence>
            <Action ID="APreparePoseArm" name="AGeneComArm" param="{param}" step="{step}" targetin="{goalarm}" targetout="{commarm}" targettype="{targettype}"/>
            <SetBlackboard name="AGeneComGripper" output_key="commgripper" value="{deinegripper}"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="T1FindObjs">
        <Sequence>
            <Action ID="AFindObjContainers" blockmarker="{blockmarker}" blockpose="{blockpose}" containermarkerA="{containermarkerA}" containermarkerB="        {containermarkerB}" containerpose="{containerpose}"/>
            <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="1" value="true"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="T2PickSteps">
        <Fallback name="T2Steps">
            <Sequence name="T2Step*">
                <SubTree ID="SubCheckPreCondition" goalarm="{BlockPose}" param="{Param}" step="3"/>
                <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="2" value="true"/>
            </Sequence>
            <Sequence name="T2Step3">
                <SubTree ID="SubCheckPreCondition" goalarm="{BlockPose}" param="{Param}" step="2"/>
                <SubTree ID="SubGenerateCommand" commarm="{CommArm}" commgripper="{CommGripper}" definegripper="none" goalarm="{BlockPose}" param="{Param}" step="3" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T2Step2">
                <SubTree ID="SubCheckPreCondition" goalarm="{BlockPose}" param="{Param}" step="1"/>
                <SubTree ID="SubGenerateCommand" commarm="{CommArm}" commgripper="{CommGripper}" definegripper="close" goalarm="{BlockPose}" param="{Param}" step="2" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T2Step1">
                <SubTree ID="SubGenerateCommand" commarm="{CommArm}" commgripper="{CommGripper}" definegripper="open" goalarm="{BlockPose}" param="{Param}" step="1" targettype="pose"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="T3PlaceSteps">
        <Fallback name="T3Steps">
            <Sequence name="T3Step*">
                <SubTree ID="SubCheckPreCondition" goalarm="{ContainerPose}" param="{Param}" step="5"/>
                <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="3" value="true"/>
            </Sequence>
            <Sequence name="T3Step3">
                <SubTree ID="SubCheckPreCondition" goalarm="{ContainerPose}" param="{Param}" step="5"/>
                <SubTree ID="SubGenerateCommand" commarm="{CommArm}" commgripper="{CommGripper}" definegripper="none" goalarm="{ContainerPose}" param="{Param}" step="6" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T3Step2">
                <SubTree ID="SubCheckPreCondition" goalarm="{ContainerPose}" param="{Param}" step="4"/>
                <SubTree ID="SubGenerateCommand" commarm="{CommArm}" commgripper="{CommGripper}" definegripper="open" goalarm="{ContainerPose}" param="{Param}" step="5" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T3Step1">
                <SubTree ID="SubGenerateCommand" commarm="{CommArm}" commgripper="{CommGripper}" definegripper="none" goalarm="{ContainerPose}" param="{Param}" step="4" targettype="pose"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Undefined ID=""/>
        <Action ID="ACheckConditionArm">
            <input_port default="{goal}" name="goal"/>
            <input_port default="{param}" name="param"/>
            <input_port default="{step}" name="step"/>
        </Action>
        <Action ID="ACheckConditionFlag">
            <input_port default="{param}" name="param"/>
            <input_port name="task"/>
        </Action>
        <Action ID="AFindObjContainers">
            <input_port name="blockmarker"/>
            <output_port name="blockpose"/>
            <input_port name="containermarkerA"/>
            <input_port name="containermarkerB"/>
            <output_port name="containerpose"/>
        </Action>
        <Action ID="AFollowPath">
            <input_port default="{plan}" name="plan"/>
        </Action>
        <Action ID="AGripperMove">
            <input_port default="{commgripper}" name="command"/>
        </Action>
        <Action ID="APathPlanning">
            <input_port default="{Target}" name="goal"/>
            <output_port default="{plan}" name="plan"/>
        </Action>
        <Action ID="APreparePoseArm">
            <input_port default="{param}" name="param"/>
            <input_port default="{step}" name="step"/>
            <input_port default="{blockpose}" name="targetin"/>
            <output_port default="{target}" name="targetout"/>
            <input_port default="{targettype}" name="targettype"/>
        </Action>
        <Action ID="AReloadParamArm">
            <input_port name="initial"/>
            <output_port default="{param}" name="param"/>
        </Action>
        <Action ID="ASetFlag">
            <output_port name="flagupdate"/>
            <input_port default="{param}" name="param"/>
            <input_port name="task"/>
            <input_port name="value"/>
        </Action>
        <Action ID="BTAdvertiseGripperCommand">
            <input_port default="{gripperin}" name="commandin"/>
            <output_port default="{GripperOut}" name="commandout"/>
        </Action>
        <Action ID="BTCheckGripperCommand">
            <input_port default="{GripperOut}" name="commandin"/>
            <output_port default="{grippercom}" name="commandout"/>
        </Action>
        <Action ID="BTIsHoldObj">
            <input_port name="tagisholdin"/>
        </Action>
        <Action ID="BTIsObjContainer">
            <input_port default="{tagisobjcon}" name="tagisobjconin"/>
        </Action>
        <Action ID="BTIsObjPose">
            <input_port name="tagisobjposein"/>
            <input_port name="targetin"/>
            <output_port name="targetout"/>
        </Action>
        <Action ID="BTPubFakeHoldObj"/>
        <Action ID="BTStringToBool">
            <output_port name="boolout"/>
            <input_port name="stringin"/>
        </Action>
        <Action ID="BTStringtoTarget">
            <input_port default="{string}" name="string"/>
            <input_port default="{target}" name="targetout"/>
        </Action>
        <Action ID="BTWaitForTarget">
            <input_port default="{Target}" name="targetin"/>
            <output_port default="{target}" name="targetout"/>
        </Action>
        <Condition ID="CheckCondition">
            <input_port name="FPicked"/>
        </Condition>
        <SubTree ID="Execution">
            <input_port default="ArmComm" name="armcomm"/>
            <output_port default="FHelp" name="fhelp"/>
            <input_port default="GripperComm" name="grippercomm"/>
        </SubTree>
        <SubTree ID="SubCheckPreCondition">
            <input_port name="goalarm"/>
            <input_port default="{Param}" name="param"/>
            <input_port name="step"/>
        </SubTree>
        <SubTree ID="SubGenerateCommand">
            <output_port default="{CommArm}" name="commarm"/>
            <output_port default="{CommGripper}" name="commgripper"/>
            <input_port name="definegripper"/>
            <input_port name="goalarm"/>
            <input_port default="{Param}" name="param"/>
            <input_port name="step"/>
            <input_port name="targettype"/>
        </SubTree>
        <SubTree ID="T1FindObjs">
            <input_port name="blockmarker"/>
            <output_port default="BlockPose" name="blockpose"/>
            <input_port name="containermarkerA"/>
            <input_port name="containermarkerB"/>
            <output_port default="ContainerPose" name="containerpose"/>
        </SubTree>
        <SubTree ID="T2PickSteps">
            <output_port default="gripperout" name="GripperOut"/>
            <input_port default="observedpose" name="ObsObjPose"/>
            <output_port default="tagishold" name="TagIsHold"/>
            <output_port default="target" name="Target"/>
        </SubTree>
        <SubTree ID="T3PlaceSteps">
            <input_port default="containerpose" name="ContainerPose"/>
            <output_port default="gripperout" name="GripperOut"/>
            <output_port default="tagisobjcon" name="TagIsObjCon"/>
            <input_port default="target" name="Target"/>
        </SubTree>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

