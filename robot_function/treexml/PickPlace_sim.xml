<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <Fallback name="Job">
            <Sequence name="Task4">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Action ID="ACheckConditionFlag" param="{param}" task="3"/>
                <Sequence name="T4finish">
                    <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="1" value="false"/>
                    <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="2" value="false"/>
                    <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="3" value="false"/>
                </Sequence>
            </Sequence>
            <Sequence name="Task3">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Action ID="ACheckConditionFlag" param="{param}" task="2"/>
                <Sequence name="T3Place">
                    <SubTree ID="T3PlaceSteps" commarm="commarm" commgripper="commgripper" containerpose="ContainerPose" param="Param"/>
                    <SubTree ID="Execution" commarm="CommArm" commgripper="CommGripper" fhelp="FHelp"/>
                </Sequence>
            </Sequence>
            <Sequence name="Task2">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Action ID="ACheckConditionFlag" param="{param}" task="1"/>
                <Sequence name="T2Pick">
                    <SubTree ID="T2PickSteps" blockpose="{blockpose}" commarm="{CommArm}" commgripper="{CommGripper}" param="{Param}"/>
                    <SubTree ID="Execution" commarm="CommArm" commgripper="CommGripper" fhelp="FHelp"/>
                </Sequence>
            </Sequence>
            <Sequence name="Task1">
                <Inverter>
                    <Action ID="ACheckConditionFlag" param="{param}" task="0"/>
                </Inverter>
                <Sequence name="T1FindObj">
                    <SubTree ID="T1FindObjs" blockmarker="1" blockpose="BlockPose" containermarkerA="2" containermarkerB="3" containerpose="ContainerPose" param="Param"/>
                </Sequence>
            </Sequence>
            <Sequence name="Help">
                <Action ID="AReloadParamArm" initial="" param="{param}"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="Execution">
        <SequenceStar>
            <Fallback name="RobotExec">
                <Sequence name="MoveRobot">
                    <Action ID="APathPlanning" goal="{commarm}" plan="{_plan}"/>
                    <Action ID="AFollowPath" plan="{_plan}"/>
                </Sequence>
                <Sequence name="NeedHelp">
                    <SetBlackboard name="ASetFlagHelp" output_key="fhelp" value="true"/>
                </Sequence>
            </Fallback>
            <Fallback name="GripperExec">
                <Sequence name="MoveGripper">
                    <Action ID="AGripperMove" command="{commgripper}"/>
                </Sequence>
                <Sequence name="NeedHelp">
                    <SetBlackboard name="ASetFlagHelp" output_key="fhelp" value="true"/>
                </Sequence>
            </Fallback>
        </SequenceStar>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="SubCheckPreCondition">
        <Sequence name="SeqCheckPreCond">
            <Action ID="ACheckConditionArm" goal="{goal}" param="{param}" step="{step}"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="SubGenerateCommand">
        <Sequence name="GenerateCom">
            <Action ID="APreparePoseArm" goal="{blockpose}" name="AGeneComArm" param="{param}" step="{step}" targetout="{commarm}" targettype="{targettype}"/>
            <SetBlackboard name="AGeneComGripper" output_key="commgripper" value="{gripperaction}"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="T1FindObjs">
        <Sequence>
            <Action ID="AFindObjContainers" blockmarker="{blockmarker}" blockpose="{blockpose}" containermarkerA="{containermarkerA}" containermarkerB="        {containermarkerB}" containerpose="{containerpose}"/>
            <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="1" value="true"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="T2PickSteps">
        <Fallback name="T2Steps">
            <Sequence name="T2Step*">
                <SubTree ID="SubCheckPreCondition" goalarm="{blockpose}" param="{param}" step="3"/>
                <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="2" value="true"/>
            </Sequence>
            <Sequence name="T2Step3">
                <SubTree ID="SubCheckPreCondition" goalarm="{blockpose}" param="{param}" step="2"/>
                <SubTree ID="SubGenerateCommand" commarm="{commarm}" commgripper="{commgripper}" goalarm="{blockpose}" gripperaction="none" param="{param}" step="3" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T2Step2">
                <SubTree ID="SubCheckPreCondition" goalarm="{blockpose}" param="{param}" step="1"/>
                <SubTree ID="SubGenerateCommand" commarm="{commarm}" commgripper="{commgripper}" goalarm="{blockpose}" gripperaction="close" param="{param}" step="2" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T2Step1">
                <SubTree ID="SubGenerateCommand" commarm="{commarm}" commgripper="{commgripper}" goalarm="{blockpose}" gripperaction="open" param="{param}" step="1" targettype="pose"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="T3PlaceSteps">
        <Fallback name="T3Steps">
            <Sequence name="T3Step*">
                <SubTree ID="SubCheckPreCondition" goalarm="{containerpose}" param="{param}" step="5"/>
                <Action ID="ASetFlag" flagupdate="{param}" param="{param}" task="3" value="true"/>
            </Sequence>
            <Sequence name="T3Step3">
                <SubTree ID="SubCheckPreCondition" goalarm="{containerpose}" param="{param}" step="5"/>
                <SubTree ID="SubGenerateCommand" commarm="{commarm}" commgripper="{commgripper}" goalarm="{containerpose}" gripperaction="none" param="{param}" step="6" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T3Step2">
                <SubTree ID="SubCheckPreCondition" goalarm="{containerpose}" param="{param}" step="4"/>
                <SubTree ID="SubGenerateCommand" commarm="{commarm}" commgripper="{commgripper}" goalarm="{containerpose}" gripperaction="open" param="{param}" step="5" targettype="waypoint"/>
            </Sequence>
            <Sequence name="T3Step1">
                <SubTree ID="SubGenerateCommand" commarm="{commarm}" commgripper="{commgripper}" goalarm="{containerpose}" gripperaction="none" param="{param}" step="4" targettype="pose"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Undefined ID=""/>
        <Action ID="ACheckConditionArm">
            <input_port default="{goal}" name="goal"/>
            <input_port default="{param}" name="param"/>
            <input_port default="{step}" name="step"/>
        </Action>
        <Action ID="ACheckConditionFlag">
            <input_port default="{param}" name="param"/>
            <input_port name="task"/>
        </Action>
        <Action ID="AFindObjContainers">
            <input_port name="blockmarker"/>
            <output_port name="blockpose"/>
            <input_port name="containermarkerA"/>
            <input_port name="containermarkerB"/>
            <output_port name="containerpose"/>
        </Action>
        <Action ID="AFollowPath">
            <input_port default="{plan}" name="plan"/>
        </Action>
        <Action ID="AGripperMove">
            <input_port default="{commgripper}" name="command"/>
        </Action>
        <Action ID="APathPlanning">
            <input_port default="{commarm}" name="goal"/>
            <output_port default="{_plan}" name="plan"/>
        </Action>
        <Action ID="APreparePoseArm">
            <input_port default="{blockpose}" name="goal"/>
            <input_port default="{param}" name="param"/>
            <input_port default="{step}" name="step"/>
            <output_port default="{target}" name="targetout"/>
            <input_port default="{targettype}" name="targettype"/>
        </Action>
        <Action ID="AReloadParamArm">
            <input_port name="initial"/>
            <output_port default="{param}" name="param"/>
        </Action>
        <Action ID="ASetFlag">
            <output_port name="flagupdate"/>
            <input_port default="{param}" name="param"/>
            <input_port name="task"/>
            <input_port name="value"/>
        </Action>
        <Action ID="BTAdvertiseGripperCommand">
            <input_port default="{gripperin}" name="commandin"/>
            <output_port default="{GripperOut}" name="commandout"/>
        </Action>
        <Action ID="BTCheckGripperCommand">
            <input_port default="{GripperOut}" name="commandin"/>
            <output_port default="{grippercom}" name="commandout"/>
        </Action>
        <Action ID="BTIsHoldObj">
            <input_port name="tagisholdin"/>
        </Action>
        <Action ID="BTIsObjContainer">
            <input_port default="{tagisobjcon}" name="tagisobjconin"/>
        </Action>
        <Action ID="BTIsObjPose">
            <input_port name="tagisobjposein"/>
            <input_port name="targetin"/>
            <output_port name="targetout"/>
        </Action>
        <Action ID="BTPubFakeHoldObj"/>
        <Action ID="BTStringToBool">
            <output_port name="boolout"/>
            <input_port name="stringin"/>
        </Action>
        <Action ID="BTStringtoTarget">
            <input_port default="{string}" name="string"/>
            <input_port default="{target}" name="targetout"/>
        </Action>
        <Action ID="BTWaitForTarget">
            <input_port default="{Target}" name="targetin"/>
            <output_port default="{target}" name="targetout"/>
        </Action>
        <Condition ID="CheckCondition">
            <input_port name="FPicked"/>
        </Condition>
        <SubTree ID="Execution">
            <input_port default="CommArm" name="commarm"/>
            <input_port default="CommGripper" name="commgripper"/>
            <output_port default="FHelp" name="fhelp"/>
        </SubTree>
        <SubTree ID="SubCheckPreCondition">
            <input_port name="goalarm"/>
            <input_port default="{param}" name="param"/>
            <input_port name="step"/>
        </SubTree>
        <SubTree ID="SubGenerateCommand">
            <output_port default="{commarm}" name="commarm"/>
            <output_port default="{commgripper}" name="commgripper"/>
            <input_port name="goalarm"/>
            <input_port name="gripperaction"/>
            <input_port default="{param}" name="param"/>
            <input_port name="step"/>
            <input_port name="targettype"/>
        </SubTree>
        <SubTree ID="T1FindObjs">
            <input_port name="blockmarker"/>
            <output_port default="BlockPose" name="blockpose"/>
            <input_port name="containermarkerA"/>
            <input_port name="containermarkerB"/>
            <output_port default="ContainerPose" name="containerpose"/>
            <input_port default="Param" name="param"/>
        </SubTree>
        <SubTree ID="T2PickSteps">
            <input_port default="BlockPose" name="blockpose"/>
            <output_port default="CommArm" name="commarm"/>
            <output_port default="CommGripper" name="commgripper"/>
            <inout_port default="Param" name="param"/>
        </SubTree>
        <SubTree ID="T3PlaceSteps">
            <output_port default="CommArm" name="commarm"/>
            <output_port default="CommGripper" name="commgripper"/>
            <input_port default="ContainerPose" name="containerpose"/>
            <inout_port default="Param" name="param"/>
        </SubTree>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

