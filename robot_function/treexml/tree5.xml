<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <Fallback name="PIck_hold_place">
            <Fallback name="Pick">
                <Inverter>
                <Action ID="BTIsHoldObj"/>
                </Inverter>
                <Inverter>
                    <Action ID="BTCameraFindTarget" targetout="{observedpose}"/>
                </Inverter>
                <Parallel threshold="2">
                    <SequenceStar name="SequenceStar control">
                        <Action ID="BTWaitForTarget" targetin="{TargetPose}" targetout="{TargetPose}"/>
                        <Action ID="BTPathPlanning" goal="{TargetPose}" makeplan="{Plan}"/>
                        <Action ID="BTFollowPath" planedplan="{Plan}"/>
                        <Action ID="BTCheckGripperCommand" commandin="{gripperin}}" commandout="{grippercom}"/>
                        <Action ID="BTGripperMove" commandin="{grippercom}"/>
                    </SequenceStar>
                    <Fallback name="Fallback updown">
                        <Sequence name="Sequence third">
                            <Inverter>
                                <Sequence>
                                    <SetBlackboard output_key="height" value="0.1"/>
                                    <Action ID="BTCheckCondition" heightin="{height}" name="Above Obj" targetin="{observedpose}"/>
                                </Sequence>
                            </Inverter>
                            <SetBlackboard output_key="height" value="0.1"/>
                            <Action ID="BTCloseToTarget" height="{height}" targetin="{observedpose}" targetout="{TargetPose}"/>
                            <SetBlackboard name="OpenGripper" output_key="gripperin" value="open"/>
                        </Sequence>
                        <Sequence name="Sequence second">
                            <Inverter>
                                <Sequence>
                                    <SetBlackboard output_key="height" value="-0.08"/>
                                    <Action ID="BTCheckCondition" heightin="{height}" name="Down" targetin="{observedpose}"/>
                                </Sequence>
                            </Inverter>
                            <SetBlackboard output_key="height" value="-0.08"/>
                            <Action ID="BTCloseToTarget" height="{height}" targetin="{observedpose}" targetout="{TargetPose}"/>
                            <SetBlackboard output_key="gripperin" value="close"/>
                        </Sequence>
                        <Sequence name="Sequence first">
                            <SetBlackboard output_key="height" value="0.1"/>
                            <Action ID="BTCloseToTarget" height="{height}" targetin="{observedpose}" targetout="{TargetPose}"/>
                            <SetBlackboard output_key="{gripperin}" value="no"/>
                        </Sequence>
                    </Fallback>
                </Parallel>
            </Fallback>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Action ID="BTCameraFindTarget">
            <output_port default="{observedpose}" name="targetout"/>
        </Action>
        <Action ID="BTCheckCondition">
            <input_port default="{height}" name="heightin"/>
            <input_port default="{observedpose}" name="targetin"/>
        </Action>
        <Action ID="BTCheckGripperCommand">
            <input_port default="{commandin}" name="commandin"/>
            <input_port default="{commandout}" name="commandout"/>
        </Action>
        <Action ID="BTCloseToTarget">
            <input_port default="{height}" name="height"/>
            <input_port default="{observedpose}" name="targetin"/>
            <output_port default="{TargetPose}" name="targetout"/>
        </Action>
        <Action ID="BTFollowPath">
            <input_port default="{Plan}" name="planedplan"/>
        </Action>
        <Action ID="BTGripperMove">
            <input_port default="{commandin}" name="commandin"/>
        </Action>
        <Action ID="BTIsHoldObj"/>
        <Action ID="BTPathPlanning">
            <input_port default="{TargetPose}" name="goal"/>
            <output_port default="{Plan}" name="makeplan"/>
        </Action>
        <Action ID="BTWaitForTarget">
            <input_port default="{TargetPose}" name="targetin"/>
            <output_port default="{TargetPose}" name="targetout"/>
        </Action>
        <Condition ID="NewGoal">
            <input_port name="globalgoal"/>
        </Condition>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

