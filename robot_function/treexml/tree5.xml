<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <SequenceStar name="SequenceStar control">
            <Parallel threshold="2">
                <SequenceStar>
                    <Action ID="BTWaitForTarget" stateexecutefree="{executefree}" statewaittarget="{waittarget}" targetin="{TargetPose}" targetout="{TargetPose}"/>
                    <Action ID="BTPathPlanning" goal="{TargetPose}" makeplan="{Plan}"/>
                    <Action ID="BTFollowPath" planedplan="{Plan}" stateexecutefree="{executefree}" statewaittarget="{waittarget}"/>
                </SequenceStar>
                <Fallback name="Fallback updown">
                    <Sequence name="Sequence third">
                        <SetBlackboard output_key="height" value="0.05"/>
                        <Action ID="BTCheckCondition" heightin="{height}" targetin="{observedpose}"/>
                        <SetBlackboard output_key="height" value="0.06"/>
                        <Action ID="BTCloseToTarget" height="{height}"  targetin="{observedpose}" targetout="{TargetPose}"/>
                    </Sequence>
                    <Sequence name="Sequence second">
                        <SetBlackboard output_key="height" value="-0.03"/>
                        <Action ID="BTCheckCondition" heightin="{height}" targetin="{observedpose}"/>
                        <SetBlackboard output_key="height" value="0.05"/>
                        <Action ID="BTCloseToTarget" height="{height}"  targetin="{observedpose}" targetout="{TargetPose}"/>
                    </Sequence>
                    <Sequence name="Sequence first">
                        <SetBlackboard output_key="target" value="0.3;0.4;0.043;0.0;0.0;0.0;1.0"/>
                        <Action ID="BTCameraFindTarget" targetout="{observedpose}" targetin="{target}"/>
                        <SetBlackboard output_key="height" value="-0.03"/>
                        <Action ID="BTCloseToTarget" height="{height}" stateexecutefree="{executefree}" statewaittarget="{waittarget}" targetin="{observedpose}" targetout="{TargetPose}"/>
                    </Sequence>
                </Fallback>
            </Parallel>
        </SequenceStar>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Action ID="BTCameraFindTarget">
            <output_port default="{observedpose}" name="targetout"/>
        </Action>
        <Action ID="BTCheckCondition">
            <input_port default="{height}" name="heightin"/>
            <input_port default="{observedpose}" name="targetin"/>
        </Action>
        <Action ID="BTCloseToTarget">
            <input_port default="{height}" name="height"/>
            <input_port default="{executefree}" name="stateexecutefree"/>
            <input_port default="{waittarget}" name="statewaittarget"/>
            <input_port default="{observedpose}" name="targetin"/>
            <output_port default="{TargetPose}" name="targetout"/>
        </Action>
        <Action ID="BTFollowPath">
            <input_port default="{Plan}" name="planedplan"/>
            <output_port default="{executefree}" name="stateexecutefree"/>
            <output_port default="{waittarget}" name="statewaittarget"/>
        </Action>
        <Action ID="BTPathPlanning">
            <input_port default="{TargetPose}" name="goal"/>
            <output_port default="{Plan}" name="makeplan"/>
        </Action>
        <Action ID="BTWaitForTarget">
            <output_port default="{executefree}" name="stateexecutefree"/>
            <output_port default="{waittarget}" name="statewaittarget"/>
            <input_port default="{TargetPose}" name="targetin"/>
            <output_port default="{TargetPose}" name="targetout"/>
        </Action>
        <Condition ID="NewGoal">
            <input_port name="globalgoal"/>
        </Condition>
        <Action ID="OpenGripper"/>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

